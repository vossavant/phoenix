!function($){qb={autocomplete:{limit:5,minChars:2},fancybox:{closeBtn:!1,margin:10,maxWidth:640,minWidth:"98%",padding:0},formData:{action:"ajax-submit",nonce:qb_ajax.ajaxNonce},minPasswordLength:6,quoteLimit:750,viewport:$(window)},qb.utility={init:function(){this.chosen(),this.fancybox(),this.onWindowLoad(),this.onWindowResize(),this.tabs(),this.timeago()},autocomplete:function(){$('[name="quote_source"]').autocomplete({lookup:qb_autocomp_sources,lookupLimit:qb.autocomplete.limit,minChars:qb.autocomplete.minChars,onSelect:function(e){$('[name="quote_source_id"]').val(e.data)}})},centerHero:function(){var e=$("#hero"),t=(qb.viewport.height()-e.height()-15)/2;qb.viewport.width()>767?e.css("margin-top",t):e.css("margin-top",0),e.fadeIn(),$(".home footer").fadeIn()},checkFacebookID:function(e,t,a){qb.formData.form_name="check-facebook-id",qb.formData.token=e,qb.formData.user_id=t;var o=$(".sso-loading"),i=o.closest("form");i.addClass("loading"),o.html("<span>Connecting to Facebook...</span>"),$.post(qb_ajax.ajaxURL,qb.formData,function(t){t=$.parseJSON(t),t.user_id?qb.utility.loginFacebookUser(e,t.user_id):"login"===a?qb.utility.registerFacebookUser(e):qb.utility.registerFacebookUser(e),delete qb.formData.form_name})},checkRegisterEmail:function(e,t,a){var o=e.closest("div").find(".error-inline"),i=e.closest("div").find(".ico");e.addClass("loading"),qb.formData.form_name="check-email",qb.formData.email=t,$.ajax({type:"POST",url:qb_ajax.ajaxURL,data:qb.formData,success:function(t){t=$.parseJSON(t),e.removeClass(),i.removeClass("error"),delete qb.formData.form_name,delete qb.formData.email,t.errors?alert(t.errors):(o.hide(),"unique"==t.result?(e.addClass("success"),i.addClass("success")):"invalid"===t.result?e.addClass("invalid"):(e.addClass("error"),i.addClass("error"),o.show())),a(t)},async:!1})},checkRegisterPassword:function(e,t){var a=e.closest("div").find(".error-inline"),o=e.closest("div").find(".ico");return t.length<qb.minPasswordLength?(e.addClass("error"),o.addClass("error"),a.show(),!1):(e.addClass("success"),o.addClass("success"),a.hide(),!0)},checkRegisterUsername:function(e,t,a){var o=e.closest("div").find(".error-inline"),i=e.closest("div").find(".ico");e.addClass("loading"),qb.formData.form_name="check-username",qb.formData.username=t,$.ajax({type:"POST",url:qb_ajax.ajaxURL,data:qb.formData,success:function(t){t=$.parseJSON(t),e.removeClass(),i.removeClass("error"),delete qb.formData.form_name,delete qb.formData.username,t.errors?alert(t.errors):(o.hide(),"unique"==t.result?(e.addClass("success"),i.addClass("success")):"invalid"===t.result?e.addClass("invalid"):(e.addClass("error"),i.addClass("error"),"too short"===t.result?o.show():o.text("Drat! This username is unavailable!").show())),a(t)},async:!1})},checkTextareaLength:function(e){var t=e.val(),a=qb.quoteLimit-t.length,o=e.closest("form").find(".charcount");return t.length>qb.quoteLimit?(e.val(t.substr(0,qb.quoteLimit)),!1):(50>a?o.addClass("dwindling"):o.removeClass("dwindling"),1===a?o.html("<span>1</span> character left"):o.html("<span>"+a+"</span> characters left"),void o.find("span").text(a))},chosen:function(){$("select").chosen({disable_search_threshold:6})},facebookLogin:function(e){FB.login(function(t){t.authResponse?qb.utility.checkFacebookID(t.authResponse.accessToken,t.authResponse.userID,e):console.log("User cancelled login or did not fully authorize.")},{scope:"public_profile, email",return_scopes:!0})},fancybox:function(){$.isFunction($.fn.fancybox)&&$(".fancybox").fancybox({afterShow:function(){setTimeout(function(){$("h2 + div").find(":input").focus()},1)},closeBtn:qb.fancybox.closeBtn,margin:qb.fancybox.margin,maxWidth:qb.fancybox.maxWidth,minWidth:qb.fancybox.minWidth,padding:qb.fancybox.padding,scrolling:"visible"})},getAutocompleteAuthors:function(){qb.formData.form_name="get-authors",$("#autocomplete-authors").length||$.post(qb_ajax.ajaxURL,qb.formData,function(e){e=$.parseJSON(e),e.errors?alert(e.errors):($("body").append('<div id="autocomplete-authors" />'),$("#autocomplete-authors").html("<script>var qb_autocomp_authors = "+e.json_response+";</script>"),$('[name="quote_author"]').autocomplete({lookup:qb_autocomp_authors,lookupLimit:qb.autocomplete.limit,minChars:qb.autocomplete.minChars,onSelect:function(e){$('[name="quote_author_id"]').val(e.data)}})),delete qb.formData.form_name}),delete qb.formData.form_name},getAutocompleteCharacters:function(){qb.formData.form_name="get-characters",$("#autocomplete-characters").length||$.post(qb_ajax.ajaxURL,qb.formData,function(e){e=$.parseJSON(e),e.errors?alert(e.errors):($("body").append('<div id="autocomplete-characters" />'),$("#autocomplete-characters").html("<script>var qb_autocomp_characters = "+e.json_response+";</script>"),$('[name="quote_character"]').autocomplete({lookup:qb_autocomp_characters,lookupLimit:qb.autocomplete.limit,minChars:qb.autocomplete.minChars,onSelect:function(e){$('[name="quote_character_id"]').val(e.data)}})),delete qb.formData.form_name}),delete qb.formData.form_name},getAutocompleteFollowing:function(){alert("this function is deprecated")},getAutocompleteSources:function(){qb.formData.form_name="get-sources",$("#autocomplete-sources").length||$.post(qb_ajax.ajaxURL,qb.formData,function(e){e=$.parseJSON(e),e.errors?alert(e.errors):($("body").append('<div id="autocomplete-sources" />'),$("#autocomplete-sources").html("<script>var qb_autocomp_sources = "+e.json_response+";</script>"),qb.utility.autocomplete()),delete qb.formData.form_name}),delete qb.formData.form_name},lazyload:function(){function e(){a=o.slice(0,-1).split("/").pop(),i=qb.viewport.scrollTop()+qb.viewport.height(),i>=$(document).height()&&o&&(t.show(),console.log(a),$.get(o,function(e){$(e).find("article.box").insertBefore(t),t.hide(),$(".page-numbers.next").attr("href",updated),o=$(e).find("#page-nav a:last-of-type").attr("href")}))}var t=$("#lazyloader"),a=0,o=$("a.page-numbers:last-child").attr("href"),i=0,r;qb.viewport.scroll(function(){clearTimeout(r),r=setTimeout(e,500)}),console.log("last page: "+$(".page-numbers.next").prev().text())},loadAjaxModal:function(e){function t(e,t){e.find("form").show(),$.fancybox.open(e,{afterLoad:function(){setTimeout(function(){$("h2 + div").find(":input").focus(),("modal-board-add"==a||"modal-board-edit"==a)&&e.find("select").chosen()},1),"modal-board-invite"==a&&qb.utility.getAutocompleteFollowing()},closeBtn:qb.fancybox.closeBtn,margin:qb.fancybox.margin,maxWidth:qb.fancybox.maxWidth,minWidth:qb.fancybox.minWidth,padding:qb.fancybox.padding,scrolling:"visible"})}var a=e.attr("data-type"),o=$("#"+a);switch(qb.formData.form_name=a,qb.formData.modal_id=e.attr("data-id"),a){case"modal-board-edit":case"modal-user-edit":qb.formData.description=e.attr("data-description"),qb.formData.name_or_title=e.attr("data-name"),qb.formData.thumbnail_src=e.attr("data-thumb"),qb.formData.background_src=e.attr("data-background");break;case"modal-board-profile":case"modal-user-profile":qb.formData.quote_count=e.attr("data-quotes"),qb.formData.follower_count=e.attr("data-followers"),qb.formData.thumbnail_src=e.attr("data-thumb"),qb.formData.background_src=e.attr("data-background");break;case"modal-user-profile":qb.formData.following_count=e.attr("data-following")}o.length?t(o,e):($("body").append('<section class="hidden '+a+'" id="'+a+'" />'),o=$("#"+a),$.post(qb_ajax.ajaxURL,qb.formData,function(a){a=$.parseJSON(a),a.errors?alert(a.errors):(o.html(a.html),t(o,e)),$.fancybox.hideLoading()})),delete qb.formData.form_name,delete qb.formData.modalId},loginFacebookUser:function(e,t){var a=$("#login-form, #register-form").find(".sso-loading");qb.formData.form_name="login-facebook",qb.formData.token=e,qb.formData.user_id=t,a.html("<span>Reticulating splines...</span>"),$.post(qb_ajax.ajaxURL,qb.formData,function(e){e=$.parseJSON(e),a.html("<span>Signing you in...</span>"),window.location.href=e.redirect_to,delete qb.formData.form_name})},onWindowLoad:function(){qb.viewport.load(function(){qb.utility.scrollDownCoverPhoto(),$("[data-columns]").animate({opacity:1})})},onWindowResize:function(){function e(){}var t;qb.viewport.resize(function(){clearTimeout(t),t=setTimeout(e,250)})},populateQuoteEditForm:function(e){var t=$("#quote-edit"),a=t.find("textarea"),o=t.find("select"),i=e.closest("article"),r=i.find("q"),n=i.find("cite").text(),s=i.find(".quote-source").text();boardID=i.attr("data-board"),quoteID=i.attr("data-id"),authorID=i.attr("data-author"),r.find("b").remove(),a.val(r.text().replace(/ +/g," ")),t.find("#edit-quote-author").val(n),t.find('[name="quote_author_id"]').val(authorID),t.find('[name="quote_source"]').val(s),o.find('option[value="'+boardID+'"]').attr("selected","selected"),o.trigger("chosen:updated"),t.find('[name="quote_board"]').val(boardID),t.find('[name="qid"]').val(quoteID),qb.utility.checkTextareaLength(a)},populateRequoteForm:function(e){var t=e.closest("article"),a=t.find("q").clone(),o=t.find("cite").clone(),i=t.attr("data-id");$("#requote-this").html(a).append(o),$('[name="reqid"]').val(i),$.fancybox.update()},readFileBeforeUpload:function(e,t){if(t.type.match(/image.*/)){var a=new FileReader;a.onload=function(){var o=new Image;o.src=a.result,e.closest(".photo").find("img").attr("src",o.src),e.closest("label").find("span").text(t.name+" ready for upload")},a.readAsDataURL(t)}else alert("Please choose an image of type GIF, JPG, or PNG")},registerFacebookUser:function(e){var t=$("#register-form, #login-form").find(".sso-loading");t.html("<span>Creating new account...</span>").fadeIn(),console.log("creating..."),FB.api("/me?fields=cover,email,first_name,last_name,link,name",function(a){console.log("response:"),console.log(a);var o="http://www.quoteboard.com/wp-content/uploads/2014/11/hero.jpg";a.cover&&(o=a.cover.source);var i=a.email,r=a.first_name,n=a.last_name,s=a.link;fbName=a.name,fbUserID=a.id,FB.api("/me/picture",{redirect:!1,height:400,type:"normal",width:400},function(a){a&&!a.error&&(qb.formData.fb_photo=a.data.url),qb.formData.form_name="register-facebook",qb.formData.token=e,qb.formData.user_id=fbUserID,qb.formData.cover=o,qb.formData.email=i,qb.formData.first_name=r,qb.formData.last_name=n,qb.formData.fb_url=s,qb.formData.full_name=fbName,$.post(qb_ajax.ajaxURL,qb.formData,function(e){e=$.parseJSON(e),t.html("<span>Almost done...</span>").fadeIn(),e.errors?(alert(e.errors),t.fadeOut()):window.location.href=e.redirect_to,delete qb.formData.form_name})})})},removePhoto:function(e){if(confirm("Are you sure you want to remove this photo?")){var t=e.closest("form"),a=e.closest(".photo"),o=a.find(".loading"),i=a.find("img"),r,n;e.addClass("hidden"),o.show(),r=t.find('input[name="bid"]').val(),n=t.find('input[name="uid"]').val(),void 0===n&&(n=!1),void 0===r&&(r=!1),qb.formData.bid=r,qb.formData.uid=n,qb.formData.form_name="remove-photo",e.hasClass("bg")?qb.formData.bg=1:qb.formData.bg=0,$.post(qb_ajax.ajaxURL,qb.formData,function(e){e=$.parseJSON(e),console.log(e),e.errors?alert(e.errors):(i.attr("src",e.thumbnail),1===e.remove_bg?$("#hero").attr("style","background: url("+e.full_img+") center no-repeat;"):$("#profile").find("img").attr("src",e.full_img).css("width",200)),o.hide(),delete qb.formData.form_name,delete qb.formData.bg,delete qb.formData.bid,delete qb.formData.uid})}},scrollDownCoverPhoto:function(){var e=$("#hero");$("body.home").length||e.length&&qb.viewport.scrollTop(.7*e.height())},tabs:function(){$(".tabs").find("a").click(function(e){var t=$(this);e.preventDefault(),$(".tabs").find("a").removeClass("active"),t.addClass("active"),$(".pane").hide(),$('.pane[id="'+t.attr("href").substring(1)+'"]').show()})},timeago:function(){$(".timeago").timeago()},updatePhotoFieldsAfterSubmit:function(e,t){t.find(".photo input").val(""),t.find(".photo label span").text("Tap here to upload a new photo"),e.profile_photo&&t.find(".photo .pp").removeClass("default"),e.bg_photo&&t.find(".photo .bg").removeClass("default")},updateProfileAfterSubmit:function(e){var t=$("#profile");t.find("p").remove(),t.find("h3").text(e.name).after(e.description),e.profile_photo&&t.find("img").attr("src",e.profile_photo)}},qb.events={init:function(){var e=this;$("body").on("click",'[type="submit"]',function(){$(this).hasClass("no-ajax")||e.submitForm($(this))}),$("select").change(function(e,t){console.log(t),$(this).closest("form").find('[name="quote_board"]').val(t.selected)}),$("a.from-board").click(function(){e.selectCurrentBoard($(this))}),$(".toggle-pw").click(function(){e.togglePasswordVisibility($(this))}),$('[type="password"]').blur(function(){}),$('[type="password"]').focus(function(){e.showPasswordToggleLink($(this))}),$("body").on("click",".close",function(){$.fancybox.close()}),$("body").on("click",'.choose-board .chosen-results li[data-option-array-index="1"], #menu-item-625, #menu-item-719',function(){e.openAddBoardInlineFancybox($(this))}),$("#menu-item-624, #menu-item-718").click(function(){e.openAddQuoteFancybox(),qb.utility.getAutocompleteAuthors(),qb.utility.getAutocompleteCharacters(),qb.utility.getAutocompleteSources()}),$("#board-create-new-inline").find(".close").click(function(){e.openFancyboxAfterAddingBoardInline($(this))}),$("body").on("click",".fave",function(){e.faveQuote($(this))}),$(".delete-quote").click(function(t){t.preventDefault(),e.eraseQuote($(this))}),$("body").on("click",".another",function(){var e=$(this).closest("form");e.find(".hidden.success").fadeOut(250,function(){$(this).slideUp(),e.find(".ajax-wrapper").fadeIn()})}),$("body").on("click",".follow, .collab",function(t){t.preventDefault(),$(this).hasClass("disabled")||e.followSomething($(this))}),$("#leave-board").click(function(t){t.preventDefault(),e.leaveBoard($(this))}),$("body").on("click",".erase-board",function(t){t.preventDefault(),e.eraseBoard($(this))}),$("body").on("click",".add-invite",function(t){t.preventDefault(),e.addUserToInviteList($(this))}),$("body").on("keypress","#invite-email",function(t){var a=t.keyCode?t.keyCode:t.which;13==a&&(e.addUserToInviteList($(this).closest("div").find(".add-invite")),t.preventDefault())}),$(".ajax-modal").click(function(e){e.preventDefault(),$.fancybox.showLoading(),qb.utility.loadAjaxModal($(this))}),$("body").on("click",".remove-invitee",function(t){t.preventDefault(),e.removeUserFromInviteList($(this))}),$("body").on("click",".remove-collab",function(t){t.preventDefault(),e.removeCollaborator($(this))}),$("body").on("click",".remove-pending-collab",function(t){t.preventDefault(),e.removePendingCollaborator($(this))}),$("#profile").on("mouseenter",".btn.following",function(){$(this).text("Unfollow")}),$("#profile").on("mouseleave",".btn.following",function(){$(this).text("Following")}),$("#profile").on("mouseenter",".btn.collaborating",function(){$(this).text("Stop Collab")}),$("#profile").on("mouseleave",".btn.collaborating",function(){$(this).text("Collaborating")}),$("body").on("click",".remove-photo",function(e){e.preventDefault(),qb.utility.removePhoto($(this))}),$("body").on("change",":file",function(){qb.utility.readFileBeforeUpload($(this),this.files[0])}),$("[data-link]").click(function(){var e=$(this);e.closest(".box").hasClass("quote")?e.closest("body").hasClass("single-quote")||(window.location.href=$(this).attr("data-link")):window.location.href=$(this).attr("data-link")}),$(".expandable").focus(function(){$(this).animate({height:150},250,function(){$(this).css({"margin-bottom":20,overflow:"auto","padding-bottom":24,"padding-left":16,"padding-right":16,"padding-top":16})}),$(this).parent().siblings(".author, .submit").slideDown(),$(this).next().fadeIn(),qb.utility.getAutocompleteAuthors()}),$(".more-options").click(function(e){e.preventDefault();var t=$(this).closest("form").find(".extra-fields");t.is(":visible")?(t.slideUp(function(){}),$("span:first-child",this).text("Add more details"),$(".ico",this).removeClass("arrow-up").addClass("arrow-down")):(t.slideDown(function(){$.fancybox.reposition()}),$("span:first-child",this).text("Hide more details"),$(".ico",this).removeClass("arrow-down").addClass("arrow-up"))}),$(".edit-quote").click(function(e){e.preventDefault(),qb.utility.populateQuoteEditForm($(this))}),$(".explore").click(function(e){e.preventDefault(),$("html, body").stop().animate({scrollTop:$("#hero").height()},750,"swing")}),$("body").on("keyup","textarea",function(){qb.utility.checkTextareaLength($(this))}),$("textarea").each(function(){qb.utility.checkTextareaLength($(this))})},addUserToInviteList:function(e){var t=$("#invite-email"),a=$(".error.invite"),o=e.closest("form").find('input[name="board_id"]').val();submitButton=e.closest("form").find('button[type="submit"]'),""===t.val().trim()?(a.show(),t.focus()):(qb.formData.form_name="invite-member-add",qb.formData.user_input=t.val(),qb.formData.invite_id=e.attr("data-id"),qb.formData.board_id=o,e.addClass("loading"),a.hide(),$.post(qb_ajax.ajaxURL,qb.formData,function(a){a=$.parseJSON(a),a.errors?alert(a.errors):(e.attr("data-id",""),$(".stacked.invitees").find('li[data-email="'+a.email+'"]').length?alert("This person is already on your invite list"):(submitButton.removeAttr("disabled"),$(".stacked.invitees").find("li:first-child").after(a.html),submitButton.before('<input name="emails[]" type="hidden" value="'+a.email+'" />'),$.fancybox.update())),t.val(""),t.focus(),e.removeClass("loading"),delete qb.formData.form_name,delete qb.formData.user_input,delete qb.formData.invite_id,delete qb.formData.board_id}))},eraseQuote:function(e){if(confirm("Are you sure you want to delete this quote? This action cannot be undone.")){e.text("Deleting...");var t=e.closest("article"),a=t.closest("main");a.prepend('<div class="overlay" />'),qb.formData.quote_id=t.attr("data-id"),qb.formData.form_name="erase-quote",$.post(qb_ajax.ajaxURL,qb.formData,function(e){e=$.parseJSON(e),e.errors?alert(e.errors):t.siblings(".box").slideUp(function(){t.slideUp(function(){t.remove(),a.prepend('<p class="message shown success">Quote deleted successfully.</p>')})}),a.find(".overlay").remove(),delete qb.formData.quote_id,delete qb.formData.form_name})}},eraseBoard:function(e){confirm("Are you sure you want to erase this board? All of this board's members will be kicked out, and all of this board's quotes will be erased. This action cannot be undone.")&&(qb.formData.form_name="erase-board",qb.formData.board_id=e.attr("data-id"),e.slideUp(),e.closest("form").find("button").attr("disabled","disabled").text("Erasing..."),$.post(qb_ajax.ajaxURL,qb.formData,function(e){e=$.parseJSON(e),e.errors?alert(e.errors):window.location.href=e.redirect_to,delete qb.formData.form_name}))},faveQuote:function(e){e.addClass("loading"),qb.formData.qid=e.closest("article").attr("data-id"),qb.formData.form_name="fave-quote",$.post(qb_ajax.ajaxURL,qb.formData,function(t){t=$.parseJSON(t),t.errors?alert(t.errors):(e.toggleClass("faved"),e.toggleAttr("title","Unfave","Fave"),t.fave_count<1?e.find("span").text(""):e.find("span").text(t.fave_count)),e.removeClass("loading"),delete qb.formData.qid,delete qb.formData.form_name})},followSomething:function(e){var t=e.text();e.hasClass("loading")||(e.addClass("loading"),e.hasClass("board")?(qb.formData.form_name="follow-board",e.hasClass("collab")&&(qb.formData.is_public=!0)):qb.formData.form_name="follow-user",qb.formData.id=e.attr("data-id"),$.post(qb_ajax.ajaxURL,qb.formData,function(t){t=$.parseJSON(t),t.errors?alert(t.errors):e.hasClass("follow")?(e.toggleClass("following"),e.toggleAttr("title","Following","Follow"),e.hasClass("btn")&&(e.hasClass("following")?e.text("Following"):e.text("Follow"))):(e.toggleClass("collaborating"),e.toggleAttr("title","Collaborating","Collaborate"),e.hasClass("btn")&&(e.hasClass("collaborating")?e.text("Collaborating"):e.text("Collaborate"))),e.removeClass("loading"),delete qb.formData.id,delete qb.formData.form_name}))},hidePasswordToggleLink:function(e){e.closest("div").find(".toggle-pw").hide()},leaveBoard:function(e){confirm("Are you sure you want to leave this board?")&&(qb.formData.form_name="leave-board",qb.formData.board_id=e.attr("data-id"),e.addClass("loading"),$.post(qb_ajax.ajaxURL,qb.formData,function(t){t=$.parseJSON(t),t.errors?alert(t.errors):window.location.href=t.redirect_to,e.removeClass("loading").slideUp(),delete qb.formData.form_name}))},openAddBoardInlineFancybox:function(e){var t=e.closest("form").attr("id"),a=$("#board-create-new");"menu-item-625"===e.attr("id")||"menu-item-719"===e.attr("id")?a.find('input[name="form_name"]').val("add-board"):(a.find('input[name="form_name"]').val("add-board-inline"),a.attr("id","board-create-new-inline")),$.fancybox.open(a,{afterShow:function(){setTimeout(function(){$("h2 + div",a).find(":input").focus()},1)},closeBtn:qb.fancybox.closeBtn,helpers:{overlay:{locked:!1}},margin:qb.fancybox.margin,maxWidth:qb.fancybox.maxWidth,minWidth:qb.fancybox.minWidth,padding:qb.fancybox.padding,wrapCSS:t})},openAddQuoteFancybox:function(){var e=$("#quote-create-new");$.fancybox(e,{afterShow:function(){setTimeout(function(){e.find("textarea").focus()},1)},closeBtn:qb.fancybox.closeBtn,margin:qb.fancybox.margin,maxWidth:qb.fancybox.maxWidth,minWidth:qb.fancybox.minWidth,padding:qb.fancybox.padding})},openFancyboxAfterAddingBoardInline:function(e){var t=e.closest(".fancybox-wrap"),a=$(".choose-board").find("select");t.hasClass("quote-create-new")?qb.events.openAddQuoteFancybox(a):t.hasClass("quote-edit")?$.fancybox.open($("#quote-edit"),{afterShow:function(){setTimeout(function(){a.trigger("chosen:activate")},1)},closeBtn:!1,margin:10,maxWidth:qb.fancybox.maxWidth,minWidth:qb.fancybox.minWidth,padding:0,wrapCSS:"quote-edit"}):t.hasClass("requote-form")?$.fancybox.open($("#requote-form"),{afterShow:function(){setTimeout(function(){},1)},closeBtn:!1,margin:10,padding:0,wrapCSS:"requote-form quote-details"}):$.fancybox.close()},removeCollaborator:function(e){var t=e.closest("li");confirm("Are you sure you want to remove this person as a collaborator? This person will still follow this board, but will be unable to add or edit quotes on this board.")&&(qb.formData.form_name="demote-member",qb.formData.user_id=t.attr("data-id"),qb.formData.board_id=e.closest("ul").attr("data-board"),e.addClass("loading"),$.post(qb_ajax.ajaxURL,qb.formData,function(a){a=$.parseJSON(a),a.errors?alert(a.errors):t.slideUp(250,function(){$(this).remove(),$.fancybox.update()}),e.removeClass("loading"),delete qb.formData.form_name}))},removePendingCollaborator:function(e){},removeUserFromInviteList:function(e){var t=e.closest("li"),a=e.closest("form"),o=t.siblings().length,i=t.attr("data-email");t.slideUp(250,function(){$(this).remove(),$.fancybox.update()}),a.find('input[value="'+i+'"]').remove(),1>o&&a.find('[type="submit"]').attr("disabled","disabled")},selectCurrentBoard:function(e){var t=e.attr("data-bid"),a=$("#quote-create-new").find('[name="quote_board"]');a.find('option[value="'+t+'"]').attr("selected","selected"),a.trigger("chosen:updated")},showPasswordToggleLink:function(e){e.closest("div").find(".toggle-pw").show()},submitForm:function(e){function t(t,a,o){if(e.attr("disabled","disabled").text("Please wait..."),"login-form"===a.attr("id")&&(a.addClass("loading"),a.find(".sso-loading").html("<span>Please wait...</span>")),"register-form"===a.attr("id")){var i=$("#register-email"),s=$("#register-password"),d=$("#register-username");a.addClass("loading"),a.find(".sso-loading").html("<span>Please wait...</span>"),qb.utility.checkRegisterEmail(i,i.val(),function(t){"unique"!==t.result?(e.removeAttr("disabled").html(r),a.removeClass("loading"),n=!1):qb.utility.checkRegisterPassword(s,s.val())?qb.utility.checkRegisterUsername(d,d.val(),function(t){"unique"!==t.result&&(e.removeAttr("disabled").html(r),a.removeClass("loading"),n=!1)}):(e.removeAttr("disabled").html(r),a.removeClass("loading"),n=!1)})}return n}function a(){alert("There was a problem with your submission; please try again later")}function o(t,a,o,i){console.log("response: "+t);var t=$.parseJSON(t);if(t.errors)alert(t.errors),e.removeAttr("disabled").html(r),i.removeClass("loading"),i.find(".sso-loading").hide();else switch(i[0].id){case"board-create-new":qb.success.createBoard(t,i);break;case"board-create-new-inline":qb.success.createBoardInline(t,i,e,r);break;case"board-invite":qb.success.sendBoardInvites(t,i,e,r);break;case"board-profile-edit":qb.success.updateBoardProfile(t,i,e,r);break;case"comment-form":qb.success.addComment(t,i,e,r);break;case"feedback-form":qb.success.sendFeedback(t,i,e,r);break;case"login-form":qb.success.loginUser(t);break;case"register-form":qb.success.registerUser(t);break;case"requote-form":qb.success.requote(t,i,e,r);break;case"quote-create-new":case"quote-create-new-inline":qb.success.createQuote(t,i,e,r);break;case"quote-edit":qb.success.updateQuote(t,i,e,r);break;case"user-profile-edit":qb.success.updateUserProfile(t,i,e,r)}}var i=e.closest("form"),r=e.html(),n=!0,s={beforeSubmit:t,data:qb.formData,error:a,success:o,url:qb_ajax.ajaxURL};i.ajaxForm(s)},togglePasswordVisibility:function(e){e.toggleClass("revealed"),e.toggleAttr("title","Hide password","Reveal password"),e.closest("div").find("input").toggleAttr("type","text","password"),e.hasClass("revealed")?e.text("Hide"):e.text("Show")}},qb.success={addComment:function(e,t,a,o){function i(){n.slideUp()}var r=$("#comment-list"),n=t.find(".message.success");r.append(e.comment_html),$(".timeago").timeago(),n.show(),t.find("textarea").val(""),a.removeClass("updated").removeAttr("disabled").text(o),setTimeout(i,8e3)},createBoard:function(e,t){window.location.href=e.permalink+"?new"},createBoardInline:function(e,t,a,o){var i=$(".choose-board").find("select");i.append('<option selected value="'+e.board_id+'">'+e.board_name+"</option>"),i.trigger("chosen:updated"),qb.events.openFancyboxAfterAddingBoardInline(a),t.find('[type="text"]').val(""),t.find("select").find("option:first-child").attr("selected","selected"),t.find("select").trigger("chosen:updated"),a.removeClass("updated").removeAttr("disabled").text(o)},createQuote:function(e,t,a,o){t.find("textarea").val(""),t.find('[name="quote_author"]').val(""),t.find('[name="quote_author_id"]').val(""),t.find('[name="quote_source"]').val(""),t.find('[name="quote_source_id"]').val(""),t.find(".charcount span").text(qb.quoteLimit),t.find(".form-options").find(".ico").removeClass("arrow-up").addClass("arrow-down"),t.find(".extra-fields").slideUp(),t.find(".more-options").find("span:first-child").text("Add more details"),a.removeClass("updated").removeAttr("disabled").text(o),"quote-create-new-inline"===t.attr("id")?(t.find(".author, .submit").slideUp(),t.find("textarea").animate({height:40,"margin-bottom":0,padding:10}),t.find(".charcount").hide(),"private"===e.privacy?privacy='<span class="status private" title="Private Quote"></span>':privacy="",t.closest(".box").after('<article class="quote box yours new hidden" data-author="'+e.added_by+'" data-board="'+e.board_id+'" data-id="'+e.quote_id+'"><a class="avatar" href="'+e.home_url+'" title="Posted by You">'+e.avatar+'</a><div><div class="bubble" data-link="'+e.quote_url+'"><h4>'+privacy+"You <span>@"+e.username+'</span></h4><time class="timeago" datetime="'+e.datetime+'">less than a minute ago</time><q>'+e.quote+'</q></div><menu><span class="ico fave" title="Fave"></span></menu></div></article>'),setTimeout(function(){$(".quote.new").slideDown()},1e3),setTimeout(function(){t.closest("main").find(".quote.new").removeClass("new")},5e3)):"quote-create-new"===t.attr("id")&&t.find(".ajax-wrapper").fadeOut(250,function(){$(this).slideUp(),e.permalink?(t.find(".hidden.success").find("span").html(e.permalink),t.find(".hidden.success").fadeIn(),t.find(".flex").find("a").attr("href",e.quote_url)):t.find(".hidden.error").fadeIn()})},loginUser:function(e){e.result===!0&&($(".sso-loading").html("<span>Signing you in...</span>"),window.location.href=e.redirect_to)},registerUser:function(e){e.result===!0&&($(".sso-loading").html("<span>Finishing registration...</span>"),window.location.href=e.redirect_to)},requote:function(e,t,a,o){function i(){r.slideUp()}var r=t.find(".success"),n=t.find("select");n.find('option[value="'+e.board_id+'"]').remove(),n.trigger("chosen:updated"),r.slideDown(),setTimeout(i,5e3),a.removeClass("updated").removeAttr("disabled").text(o)},sendBoardInvites:function(e,t,a,o){var i="";i=e.result[0][0]?e.result[0][0].status:"error",t.find(".inner-btn, .who-can-add, div:last-of-type").animate({opacity:0},250,function(){$(this).slideUp(),"sent"===i?t.find(".hidden.success").fadeIn(250,function(){$.fancybox.update()}):t.find(".hidden.error").fadeIn(250,function(){$.fancybox.update()})})},sendFeedback:function(e,t,a,o){var i="";i=e.result[0][0]?e.result[0][0].status:"error","error"!==i?t.find(".message.success").slideDown():t.find(".message.error").slideDown(),t.find("textarea").val(""),t.find(".charcount span").text(qb.quoteLimit),a.removeClass("updated").removeAttr("disabled").text(o)},updateBoardProfile:function(e,t,a,o){qb.utility.updatePhotoFieldsAfterSubmit(e,t),qb.utility.updateProfileAfterSubmit(e),e.bg_photo&&$("#hero").attr("style","background: url("+e.bg_photo+") center no-repeat;"),qb.success.updateSubmitButton(a,o)},updateQuote:function(e,t,a,o){var i=$('.quote.box[data-id="'+e.quote_id+'"]'),r=$(".quote-edit.success");a.removeClass("updated").removeAttr("disabled").text(o),i.find("q").html(e.quote_text),i.find("cite").html(e.quote_author),i.attr("data-author",e.quote_author_id),i.attr("data-board",e.quote_board_id),"private"!==e.quote_status||i.find(".private").length?i.find(".private").remove():(i.find("h4").prepend('<span class="status private" title="Private Quote"></span>'),i.find("footer").append('<span class="private" title="This is a private quote">Private</span>')),i.find(".quote-source").length?i.find(".quote-source").html(e.quote_source):i.find("cite").after('<span class="box-meta quote-source">'+e.quote_source+"</span>"),$(".boards.box").find("li:first-child").html(e.quote_board_img),$.fancybox.close(),r.slideDown(),setTimeout(function(){r.slideUp()},8e3)},updateSubmitButton:function(e,t){e.addClass("updated").text("Updated!"),setTimeout(function(){e.removeClass("updated").removeAttr("disabled").text(t),$.fancybox.close()},2500)},updateUserProfile:function(e,t,a,o){qb.utility.updatePhotoFieldsAfterSubmit(e,t),qb.utility.updateProfileAfterSubmit(e),$("#dropdown-avatar").find("img").attr("src",e.profile_photo).attr("width",48).attr("height",48),e.bg_photo&&$("#hero").attr("style","background: url("+e.bg_photo+") center no-repeat;"),qb.success.updateSubmitButton(a,o)}}}(jQuery),jQuery.fn.toggleAttr=function(e,t,a){return this.each(function(){var o=jQuery(this);o.attr(e)==t?o.attr(e,a):o.attr(e,t)})};